## 5.5 Monster AI

In this chapter, a more detailed explanation of the monster’s AI, artificial intelligence, is given. That is, it will explain how the monster decide what to do. It will also explain in more detail how monsters act in general. Basically one can say that a monster can do 3 different things; move in some way, attack in some way or stand still in some way.


### 5.5.1 General information

Just like a player, a monster will always have a specific action which it will be doing. Also, just as players, it must finish the current action before it can chose to do a new action. Some outside events may sometimes force a monster into a new specific action. Such events be the monster being hit and set into hit recover, a Fallen One retreating due to having a companion killed.

As explained in chapter 6, monsters, players and other things in the game are updated in a specific order and once every 0.05 seconds. During the update of each monster it will typically continue with the monster’s current action and if it during the update reaches the end of that action it terminates it.

When a monster terminates an action, it will be set into *stand* mode. Stand mode is basically the monster doing nothing (note *delaying* is basically standing but for a predetermined time). The first thing that happens when a monster is set to *stand* mode is that it will check for a target. Thus, a monster always has a target, even if it is not activated and no enemy is in sight. For a description of target selection, see chapter 5.5.6. When a monster is in *stand* mode it will check for a new action by following a special script specific for the attack type the monster has. Note that a unique monster, and its mob if any, may have its attack type changed, see chapter 5.4, it will then follow the script of the new attack type. For a list of attack type for each monster, see chapter 5.3.3. The script may either end up in the monster being set into a new action type, or remaining in *stand* mode.

At any time, the game, for each monster, thus has complete knowledge of what target the monster has. It also knows where the target is and will as appropriate, calculate the distance to the target. It also always know what action the monster performed previous to being set to *stand* mode. In addition, while in stand mode, a special counter will keep track of how long the monster have been in *stand* mode. All this may often be important when going through the various scripts to decide the next action.

Within the scripts, some common tasks are very often performed either at the start or at the end. One of them is calculate the distance to its target. The game will also check the direction in which the target is located. This is usually used to determine in what direction the monster will walk. This chapter will *not* deal with path algorithms used, or explain how a monster walk. Many monsters will walk towards the target in the closest possible way, others will (at times depending on the distance to the target) instead walk around the target and so on. This chapter will generally just tell that the monster will chose to *walk* as its next action. Usually at the end of the script, if the monster is still in *stand* mode, it will turn around towards it target if necessary.


### 5.5.2 Activating monsters

All monsters on a new level starts in a non active state (monsters with the Hidden attack type are an exception as they are always active, see chapter 5.5.9 under the *Hidden* subsection). As soon as a monster is within a players light radius and the view between the monster and the player is not obstructed by walls, the monster will be activated. While not activated, most monsters will not act although some exceptions exists, see chapter 5.5.7. Examples of such exceptions are archers and Succubi still being able to fire at golems or if a monster is attacked in any way. When a monster leaves the light radius of a player, it will continue to act for 12.75 seconds until it is set into non active status again unless it during that time, again enter the light radius of a player or is ”activated” again. Some monsters with the capability of following players outside their current view will try to walk around possible obstacles to get to the former target when it get out of the light radius. See chapter 5.3.3 for more information about which monsters have this capability.


### 5.5.3 About walking

There are several different ways monsters walk in the game. The exact nature of how monster walking is done will not always be described in detail. Some general comments is needed though. Below are given very general description of some common walk behavior. They are given as a general information. Changes and diversions may exists. Also, if while walking the path is blocked, monsters may behave slightly different. Some times it will try alternative paths and other times abort its walk and reconsider its action. Some monsters have very specific walk behavior and those will be described within the actual AI script.

#### **Walking Towards Target**
The monster will generally walk **directly towards the target** in the closest possible way. It will typically walk **around smaller obstacles**.  
✅ **Example monsters:** *The Hiddens, Skeletons*.

#### **Walking Towards Last Seen Position**
Similar to walking towards the target, but if the target **leaves the line of sight**, the monster will walk towards the **last known location** instead.  
- If the monster **does not find a path** to the target, it will **wander around** the last seen area until **deactivated**.  
✅ **Example monsters:** *Balrogs, Gargoyles, Scavengers*.

#### **Walking Away from Target**
The monster will **try to create distance** from the target, **including walking sideways** if directly blocked. However, it **will not walk past** the target.  
- This is why some monsters can be **trapped in corners**.  
✅ **Example monsters:** *Hiddens, Succubi, Archers, Mages*.

#### **Walking in a Circle**
Many monsters use **circular movement**, meaning they walk **around the target** without necessarily increasing or decreasing distance.  
- Once a monster starts circling, it will continue until it:  
  - **Moves twice the max distance** to the target.  
  - **Enters a new area**.  
  - **Gets within 1 tile** of the target.  
- The direction of movement is **randomized (50/50)** between clockwise and counterclockwise.  
✅ **Example monsters:** *Balrogs, Lightning Demons, Spitters, Diablo, Skeleton King*.



### 5.5.4 About charging

If a monster has the possibility to charge and it has been decided that it should charge, the game will check if there is really a path along which to charge that is not blocked by for example lava or a fence. If that is the case, the script will generally continue finding another action to perform as if it was decided to not charge.


### 5.5.5 About ranged attack

When the game has decided to do a ranged attack, it will check if line of sight is blocked. If that is the case, the script will generally continue finding another action to perform as if it was decided to not do a ranged attack. Note however, that this check many times will not detect all hindrance which may result in the ranged attack being performed but yet hit an obstacle before reaching the target.


### 5.5.6 Target selection

When a monster is to choose which player character to attack (if there is more than one present in the game) it will generally chose the one that is closest. However, the process of finding out who is the closest is somewhat non intuitive as the game does not calculate the true distance, but separates distances for the 2 main axis of the dungeon. This is most easily explained with an example.

1. The dungeon is divided into several ”squares” of which each square can hold a monster, player, or some dungeon inventory. Call the axis of squares running from the upper left to the lower right X, and the one running from lower left to the upper right Y.
2. The game will then calculate the distance to each character separately for X and Y direction.
3. It will then for each character use the largest distance of X and Y.
4. Comparing the distance got from step 3, it will attack the one with the shortest distance.
5. If two characters are equally close, the one that has first entered the game will be the target. It is thus wise to have Warriors enter and create a game, then have the Rogues enter it and finally the Sorcerers. If someone leaves the game, the next person to enter the game will take the place of the character that just left, *not* the last place.

A monster will, of course, only consider those characters, including golems, that are within its current visible range and are not out of sight due to a wall or other obstacle. Golems are only targeted if adjacent to the monster or if the monster is a skeleton archer, goat archer or succubi at any distance.

If the target ever disappears form the sight of the monster, it tends to walk up to the last position the target was seen. If the target is still not visible, it will try to pick a new target. Some monsters, as noted in chapter 5.3.3, have the ability to follow a target even if it is out of sight. In that case, they will not walk up to the last position of the target or stop, but will instead find the closest way to the target if it is not too far away.


### 5.5.7 Non even distributed random numbers

Diablo and Hellfire uses a pretty good algorithm for random numbers, unfortunately it is at times used improperly which result in somewhat non random results at time. One of those cases exists in the AI scripts of Spitters, Magma Demons, Lightning Demons, Bone Demons and Diablo. Contrary to other AI scripts they use Rnd[10000] in some cases. Unfortunately the algorithm for random numbers only use 15 bits to calculate random numbers (it uses 32 bits internally but the random number is based on 15 bits only). This has the side effect that large values used in Rnd[x] will not be evenly distributed. In the case of Rnd[10000] lower values will be more common as there are really only 32 768 possible random integers. This is further complicated by the fact that the game then as a second random number in those AI scripts mentioned above uses a Rnd[100] but still compare the result as if it was a Rnd[10000] meaning the result will always default as if it was a low random number.

A further problem is the fact that the game reseeds the random number generator before processing the monsters. This is done to keep the game better in synch in multi player. Unfortunately this also cause problems in that monsters will not always act as they are supposed to, cause long streaks of the same result. An example is a monster missing continuously for almost an infinite time when they in fact should hit way more often due to having a auto To Hit for example (see chapter 5.1 under To Hit). This only affect monster behavior though, nothing else like item drops or the behavior of spells.


### 5.5.8 Reseed bug

In an attempt to keep monsters more in synch between computers in a multi player game, Blizzard has unfortunately used a rather strange and incorrect way of reseeding the random number generator in Diablo right before processing monsters (technically each monster has its own seed used for its behavior and it is the seeds of the monsters that are reseeded). This may cause the familiar result of a monster getting ”stuck” with a particular behavior or result both when acting and when attacking. This is unfortunate.


### 5.5.9 AI scripts

Here each of the different attack types will be described. Many monsters, but not all, have special behavior types of an overreaching nature. Often composed of several actions performed in succession either until completed or aborted for some reason. They will be explained separately at the start of each script. A *general* section describes things usually performed every time. This includes a monster under an overreaching behavior.

The step by step instructions to follow are divided into several sections depending on the distance to the target. Use the appropriate one. Some times further conditions may also be given. For the specific step by step, you should use them in the following way. Always start at number 1. If at anytime it says *goto #*, where # is a number, immediately move to that line and continue from there. If it at any time says *exit*, the script has finished and you should not read any more. If you exit or reach the end without a new action being set, the monster will continue to stand and will check again 0.05 seconds later, that is during the next update, see chapter 6.1for more information about how the game updates monsters and other things.

The scripts will only refer to attack options such as melee attack or ranged attack. For information about what type of ranged attack monsters have, see chapter 4.2.

Finally note that although quite detailed, there might still be many special cases, exceptions and other smaller facts omitted. It is still my belief that it is a comprehensive explanation of each attack type that will cover almost all cases.

Some common abbreviations are used in this chapter:

#### **D - Distance to Target**
- Represents the distance between the **monster and its target**.
- A **distance of 1** means the monster is **adjacent** to the target.
- See **Chapter 6.1.9** for details on **calculating distance to a walking target**.

#### **R - Random Value**
- Represents a **random number** used in monster behavior calculations.
- The **specific script** for each monster determines how this number is generated.

#### **Intf - Intelligence Factor**
- Defines the **intelligence level** of a monster.
- Higher values indicate **more advanced behavior**.
- See **Chapter 5.3.3 and 5.4** for further details.

#### **light - Player Light Radius**
- Refers to the **light radius of players**, affecting **monster detection** and **visibility mechanics**.

---
---

### **Zombie AI**

---

#### **1. Initial Conditions**
- **If out of light radius** → **Exit** *(Monster remains inactive).*
- **Set Random Value:**  
  - `R = Rnd[100]` *(A random number between 0 and 99).*

---

### **2. Engagement Logic**
#### **If Adjacent to Target (`Distance = 1`)**
1. **If** `R < (2 × Intf) + 10` → **Perform Melee Attack**, then **Exit**.
2. **Otherwise** → **Continue to stand still**.

#### **If Target is Nearby (`2 ≤ Distance ≤ (2 × Intf) + 3`)**
1. **If** `R < (2 × Intf) + 10` → **Walk Towards Target**, then **Exit**.
2. **Otherwise** → **Continue to stand still**.

#### **If Target is Far Away (`Distance > (2 × Intf) + 3`)**
1. **If** `R ≥ (2 × Intf) + 10` → **Continue to stand still**, then **Exit**.
2. **Otherwise**, **set new random value**:  
   - `R = Rnd[100]`
3. **If** `R < (2 × Intf) + 20` → **Walk in a random direction**  
   - *(If blocked, continue to stand still)* → **Exit**.
4. **Otherwise** → **Continue walking in the same direction as last time**  
   - *(If blocked, continue to stand still)*.

---
---

### **Fallen One AI**

---

#### **1. Special Behaviors**
##### **Retreating Behavior**
- When **any monster is killed**, **Fallen Ones within 5 squares** will **retreat**.
- The distance each **Fallen One** retreats depends on its subtype:

| **Fallen One Type** | **Retreat Distance** |
|---------------------|---------------------:|
| Fallen One         | 7                     |
| Carver            | 5                     |
| Devil Kin         | 3                     |
| Dark One         | 2                     |

##### **War Cry Behavior**
- **Occasionally, a Fallen One will perform a "War Cry"**, jumping and screaming.
- **Any nearby Fallen Ones (not currently attacking) will enter "War Cry Mode."**
- **War Cry Mode lasts for a set duration**, depending on the subtype:

| **Fallen One Type** | **War Cry Range** | **Duration (Seconds)** |
|---------------------|-----------------:|----------------------:|
| Fallen One         | 4                 | 5.25                  |
| Carver            | 5                 | 6.75                  |
| Devil Kin         | 6                 | 8.25                  |
| Dark One         | 7                 | 9.75                  |

- While in **War Cry Mode**, the Fallen One will:
  1. **Rush straight at the nearest target**.
  2. **If adjacent to the target, it will attack without pausing**.
  3. **If any nearby monster dies**, it will immediately **switch to retreat mode**.
  4. **When doing a war cry, the monster gains `(2 × Intf) + 2` HP** (but does not exceed max HP).

---

### **2. Engagement Logic**
#### **If Performing a War Cry**
1. **If `Distance = 1`** → **Perform Melee Attack**, then **Exit**.
2. **Otherwise** → **Walk directly towards target**.

#### **If Retreating**
1. **Walk away from target until retreat distance is achieved**, then **Exit**.

---

### **3. General AI Behavior**
#### **Initial Conditions**
1. **If not active** → **Exit** *(Monster remains inactive)*.
2. **If the monster has been standing for an even multiple of `0.55` seconds (`0.60` if using a sword) and `Rnd[4] = 0`**, perform a **War Cry**, then **Exit**.
3. **Set random value:**  
   - `R = Rnd[100]`

---

#### **If Adjacent to Target (`Distance = 1`)**
1. **If last action was a delay** → **Perform Melee Attack**, then **Exit**.
2. **If** `R < (2 × Intf) + 20` → **Perform Melee Attack**, then **Exit**.
3. **Otherwise**, **perform delay** for:  
   - `(Rnd[10] + 10 - (2 × Intf)) / 20` seconds.

---

#### **If Target is Further Away (`Distance > 1`)**
1. **If last action was a delay** → **Walk towards last seen position of the target**, then **Exit**.
2. **If** `R < (4 × Intf) + 65` → **Walk towards last seen position of the target**, then **Exit**.
3. **Otherwise**, **perform delay** for:  
   - `(Rnd[10] + 15 - (2 × Intf)) / 20` seconds.

---
---

### **Skeleton AI**

---

### **1. General AI Behavior**
#### **Initial Conditions**
1. **If not active** → **Exit** *(Monster remains inactive)*.
2. **Set random value:**  
   - `R = Rnd[100]`

---

### **2. Engagement Logic**
#### **If Adjacent to Target (`Distance = 1`)**
1. **If last action was a delay** → **Perform Melee Attack**, then **Exit**.
2. **If** `R < (2 × Intf) + 20` → **Perform Melee Attack**, then **Exit**.
3. **Otherwise**, **perform delay** for:  
   - `(Rnd[10] + 10 - (2 × Intf)) / 20` seconds.

---

#### **If Target is Further Away (`Distance > 1`)**
1. **If last action was a delay** → **Walk towards last seen position of the target**, then **Exit**.
2. **If** `R < (4 × Intf) + 65` → **Walk towards last seen position of the target**, then **Exit**.
3. **Otherwise**, **perform delay** for:  
   - `(Rnd[10] + 15 - (2 × Intf)) / 20` seconds.

---
---

### **Skeleton Archer AI**

---

### **1. General AI Behavior**
#### **Initial Conditions**
1. **If not active** → **Exit** *(Monster remains inactive)*.
2. **Set random value:**  
   - `R = Rnd[100]`

---

### **2. Engagement Logic**
#### **If Close to Target (`Distance = 1 to 3`)**
1. **If last action was walking, standtime = 0, and** `R < (2 × Intf) + 63` → **Walk away from target**, then **Exit**.
2. **If standtime > 1 second and** `R < (2 × Intf) + 13` → **Walk away from target**, then **Exit**.

---

#### **If Far from Target (`Distance > 3`)**
1. **If** `R < (2 × Intf) + 3` → **Perform Ranged Attack**, then **Exit**.

---
---

### **Scavenger AI**

---

### **1. Special Mechanic: Eating Mode**
- **Triggered when** `curHP < maxHP / 2`.
- **Scavenger will seek out the closest carcass** of a dead monster within sight.
- **While eating, it regenerates HP faster than normal** *(see chapter 5.1: Hit Points for details)*.

---

### **2. Eating Mode Behavior**
1. **If monster is part of a unique monster’s mob** → **Remove it from the mob**.
2. **If at a carcass** → **Enter eat mode**, then **Exit**.
3. **Otherwise** → **Walk toward the closest carcass**.

---

### **3. General AI Behavior**
#### **Initial Conditions**
1. **If HP is below 50%** → **Set Eating Mode**, then **Exit**.
2. **If not active** → **Exit** *(Monster remains inactive)*.
3. **Set random value:**  
   - `R = Rnd[100]`

---

### **4. Engagement Logic**
#### **If Close to Target (`Distance = 1`)**
1. **If last action was delay** → **Perform Melee Attack**, then **Exit**.
2. **If** `R < (2 × Intf) + 20` → **Perform Melee Attack**, then **Exit**.
3. **Otherwise** → **Delay for `(Rnd[10] + 10 - (2 × Intf)) / 20` seconds**.

---

#### **If Far from Target (`Distance > 1`)**
1. **If last action was delay** → **Walk toward the last seen position of the target**, then **Exit**.
2. **If** `R < (4 × Intf) + 65` → **Walk toward the last seen position of the target**, then **Exit**.
3. **Otherwise** → **Delay for `(Rnd[10] + 15 - (2 × Intf)) / 20` seconds**.

---
---

### **Winged Fiends AI**

---

#### **1. Special Mechanic: Retreat Mode**
- **Activated after performing a melee attack**.
- **Retreat Pattern:**
  - Moves **away** from the target.
  - Then moves **to a new adjacent position**, forming a **V-shaped retreat pattern**.

---

### **2. Retreat Mode Behavior**
1. **If the last voluntary action (except walk) was not an attack** → **Exit Retreat Mode**.
2. **If the last walk was away from the target** → **Randomly walk to either the right or left of the target**, then **Exit**.
3. **Otherwise** → **Walk away from the target**.

---

### **3. General AI Behavior**
#### **Initial Conditions**
1. **If not active** → **Exit** *(Monster remains inactive)*.
2. **Set random value:**  
   - `R = Rnd[100]`

---

### **4. Engagement Logic**
#### **If Close to Target (`Distance = 1`)**
1. **If** `R < (4 × Intf) + 8` → **Perform Melee Attack**.
2. **If** `R < (4 × Intf) + 8` **and the monster is a Familiar** → **Spawn Lightning Bolt Attack**.

---

#### **If Mid-Range (`Distance = 2 to 3`)**
1. **If the last action was walking**, **standtime = 0**, and `R < Intf + 63` → **Walk toward target**, then **Exit**.
2. **If standtime > 1 second** and `R < Intf + 13` → **Walk toward target**.

---

#### **If Long-Range (`Distance > 3`)**
1. **If** `R < (4 × Intf) + 33` **and the monster is a Gloom** → **Perform Charge Attack**.
2. **If the last action was walking**, **standtime = 0**, and `R < Intf + 63` → **Walk toward target**, then **Exit**.
3. **If standtime > 1 second** and `R < Intf + 13` → **Walk toward target**.

---
---

### **Hidden AI**

---

#### **1. Special Mechanic: Retreat on Stun**
- **Monsters with the Hidden attack type will retreat when stunned**, even if they are not part of *The Hiddens* monster type.
- **Retreat behavior:**
  - **Most Hidden-type monsters** retreat **directly away** from the player.
  - **Unseen monsters** retreat **diagonally away** (randomly right or left).
  - **If the target is a monster**, retreat is defined **relative to the controlling player**.
  
#### **Retreat Distance Based on Intelligence Factor**
| **Intelligence Factor** | **Retreat Distance** |
|------------------------:|---------------------:|
| 0                      | 8                   |
| 1                      | 7                   |
| 2                      | 6                   |
| 3                      | 5                   |

#### **2. Always Active**
- **Hiddens are always active**, meaning they move around **regardless of player activation**.

---

### **3. Retreat Behavior**
1. **If the monster is an Unseen** → **Retreat diagonally away** (randomly right or left), then **Exit**.
2. **Otherwise** → **Retreat straight away from the target**, then **Exit**.

---

### **4. General AI Behavior**
#### **Initial Conditions**
1. **Set random value:**  
   - `R = Rnd[100]`
2. **If** `D < (5 - Intf)` **and not visible** → **Fade in**, then **Exit**.
3. **If** `D > (5 - Intf)` **and visible** → **Fade out**, then **Exit**.

---

### **5. Engagement Logic**
#### **If Close to Target (`Distance = 1`)**
1. **If** `R < (4 × Intf) + 10` → **Perform Melee Attack**.

---

#### **If Further from Target (`Distance > 1`)**
1. **If the last action was walking**, **standtime = 0**, and `R < Intf + 64` → **Walk toward target**, then **Exit**.
2. **If standtime > 1 second** and `R < Intf + 14` → **Walk toward target**.

---
---

### **Goat Man AI**

---

#### **1. Special Mechanic: Circle Walk**
- When a Goat Man finishes a **circle walk**, it will **walk toward the last seen position of the target**.

---

### **2. General AI Behavior**
#### **Initial Conditions**
1. **If not active** → **Exit**.
2. **Set random value:**  
   - `R = Rnd[100]`

---

### **3. Engagement Logic**
#### **If Close to Target (`Distance = 1`)**
1. **If** `R ≥ (2 × Intf) + 23` → **Exit**.
2. **If** `curHP ≥ (maxHP / 2)`, **Perform Melee Attack**, then **Exit**.
3. **Otherwise, if** `Rnd[2] = 0` → **Perform Melee Attack**, then **Exit**.
4. **If none of the above**, **Perform Special Spin Attack**.

---

### **4. Out of Light AI (`Distance > 1, Out of Light`)**
1. **If last action was walking**, **standtime = 0**, and `R < (2 × Intf) + 78` → **Walk toward last seen position of target**, then **Exit**.
2. **If standtime > 1 second** and `R < (2 × Intf) + 28` → **Walk toward last seen position of target**.

---

### **5. In Light AI (`Distance = 1 to 3, In Light`)**
1. **If the target is in another area** → **Use Out of Light AI**.
2. **If last action was walking**, **standtime = 0**, and `R < (2 × Intf) + 78` → **Walk toward last seen position of target**, then **Exit**.
3. **If standtime > 1 second** and `R < (2 × Intf) + 28` → **Walk toward last seen position of target**.

---

### **6. In Light AI (`Distance > 3, In Light`)**
1. **If the target is in another area** → **Use Out of Light AI**.
2. **If `D > 3` and `Rnd[4] = 0`** → **Start Circle Walk**, then **Exit**.
3. **Otherwise**, follow normal engagement logic:
   - **If last action was walking**, **standtime = 0**, and `R < (2 × Intf) + 78` → **Walk toward last seen position of target**, then **Exit**.
   - **If standtime > 1 second** and `R < (2 × Intf) + 28` → **Walk toward last seen position of target**.

---

### **Overlord AI**

---

### **1. General Behavior**
1. **If not active** → **Exit**.
2. **Set random value:**  
   - `R = Rnd[100]`

---

### **2. Engagement Logic**
#### **If Close to Target (`Distance = 1`)**
1. **If** `R < (4 × Intf) + 15` → **Perform Melee Attack**, then **Exit**.
2. **If** `R < (4 × Intf) + 20` → **Perform Second Melee Attack**.

---

### **3. If Not Adjacent to Target (`Distance > 1`)**
1. **If last action was walking**, **standtime = 0**, and `R < Intf + 70` → **Walk towards target**, then **Exit**.
2. **If standtime > 1 second** and `R < Intf + 20` → **Walk towards target**.

---
---

### **Gargoyle AI**

---

### **1. Stone Mode Behavior**
- **Stone "State"** = When actually in stone form.
- **Stone "Mode"** = Includes both stone state and when retreating due to low HP.
- While in stone state, Gargoyles regenerate HP faster (see Chapter 5.1).

#### **Entering Stone Mode**
1. **If** `D < Intf + 2` → **Mark as NOT in Stone Mode**.
2. **If** `curHP >= maxHP/2` → **Mark as NOT in Stone Mode**.
3. **If** `D ≥ Intf + 2` → **Enter Stone State**, then **Exit**.
4. **Otherwise** → **Walk away from target**.

---

### **2. General Behavior**
1. **If not active** → **Exit**.
2. **Set random value:**  
   - `R = Rnd[100]`
3. **If** `curHP < maxHP/2` → **Enter Stone Mode**.

---

### **3. Engagement Logic**
#### **If Close to Target (`Distance = 1`)**
1. **If** `R ≥ (2 × Intf) + 23` → **Exit**.
2. **Otherwise**, **Perform Melee Attack**.

#### **If Target is Out of Light (`Distance > 1, Out of Light`)**
1. **If last action was walking**, **standtime = 0**, and `R < (2 × Intf) + 78` → **Walk towards last seen position of target**, then **Exit**.
2. **If standtime > 1 second** and `R < (2 × Intf) + 28` → **Walk towards last seen position of target**.

#### **If Target is In Light (`Distance = 1 to 3, In Light`)**
1. **If target is in another area**, **use Out of Light AI**.
2. **If last action was walking**, **standtime = 0**, and `R < (2 × Intf) + 78` → **Walk towards last seen position of target**, then **Exit**.
3. **If standtime > 1 second** and `R < (2 × Intf) + 28` → **Walk towards last seen position of target**.

#### **If Target is In Light (`Distance > 3, In Light`)**
1. **If target is in another area**, **use Out of Light AI**.
2. **If `D > 3` and `Rnd[4] = 0`** → **Start Circle Walk**, then **Exit**.
3. **If last action was walking**, **standtime = 0**, and `R < (2 × Intf) + 78` → **Walk towards last seen position of target**, then **Exit**.
4. **If standtime > 1 second** and `R < (2 × Intf) + 28` → **Walk towards last seen position of target**.

---
---

### **Goat Archer AI**

---

### **1. General Behavior**
1. **If not active** → **Exit**.
2. **If out of sight of target AND the target is a player** → **Walk towards last seen position of target**, then **Exit**.
3. **Set random value:**  
   - `R = Rnd[100]`
4. **If last action was a ranged attack** → **Delay for `Rnd[20] / 20` seconds**, then **Exit**.

---

### **2. Engagement Logic**
#### **If Target is Close (`Distance = 1 to 3`)**
1. **If** `R < (10 × Intf) + 70` → **Walk away from target**, then **Exit**.

#### **If Target is at a Safe Distance (`Distance > 3`)**
1. **Perform Ranged Attack**.

---
---

### **Fast Spit AI**

---

### **1. General Behavior**
1. **If not active** → **Exit**.
2. **If out of sight of target AND the target is a player** → **Walk towards last seen position of target**, then **Exit**.
3. **Set random value:**  
   - `R = Rnd[100]`

---

### **2. Engagement Logic**
#### **If Target is Close (`Distance = 1 to 3`)**
1. **If** `R < (10 × Intf) + 70` → **Walk away from target**, then **Exit**.

#### **If Target is at a Safe Distance (`Distance > 3`)**
1. **Perform Ranged Attack**.

---
---

### **Magma Demon AI**

---

### **1. Circle Walk Behavior**
1. **If** `R < 100 × (5 × Intf + 5)`, **perform ranged attack**, then **Exit**.
   - *(After this ranged attack, the monster will resume circle walking.)*
2. **Otherwise**, continue **Circle Walk**.

---

### **2. General Behavior**
1. **If not active** → **Exit**.
2. **Set random value:**  
   - `R = Rnd[10000]`

---

### **3. Engagement Logic**
#### **If Target is Adjacent (`Distance = 1`)**
1. **If** `R < 100 × (5 × Intf + 5)`, **perform ranged attack**, then **Exit**.
2. **If** `R < 100 × (10 × Intf + 60)`, **perform melee attack**, then **Exit**.
3. **Otherwise**, **delay action** for `(Rnd[10] + 5) / 20` seconds.

---

#### **If Target is Out of Light (`Distance > 1`)**
1. **Recalculate random value:**  
   - `R = Rnd[100]`
2. **If** `R < 100 × (10 × Intf + 50)`, **walk towards last seen position of target**, then **Exit**.
3. **If last action was walking AND `standtime = 0` AND** `R < 100 × (10 × Intf + 80)`,  
   - **Walk towards last seen position of target**, then **Exit**.
4. **Otherwise**, **delay action** for `(Rnd[10] + 5) / 20` seconds.

---

#### **If Target is Visible (`Distance = 2`)**
1. **If target is in another area** → **Use "Out of Light" AI**.
2. **If** `R < 100 × (5 × Intf + 5)`, **perform ranged attack**, then **Exit**.
3. **Recalculate random value:**  
   - `R = Rnd[100]`
4. **If** `R < 100 × (10 × Intf + 50)`, **walk towards last seen position of target**, then **Exit**.
5. **If last action was walking AND `standtime = 0` AND** `R < 100 × (10 × Intf + 80)`,  
   - **Walk towards last seen position of target**, then **Exit**.
6. **Otherwise**, **delay action** for `(Rnd[10] + 5) / 20` seconds.

---

#### **If Target is Further Away (`Distance > 2`)**
1. **If target is in another area** → **Use "Out of Light" AI**.
2. **If** `Rnd[4] = 0`, **Start Circle Walk**, then **Exit**.
3. **If** `R < 100 × (5 × Intf + 10)`, **perform ranged attack**, then **Exit**.
4. **Recalculate random value:**  
   - `R = Rnd[100]`
5. **If** `R < 100 × (10 × Intf + 50)`, **walk towards last seen position of target**, then **Exit**.
6. **If last action was walking AND `standtime = 0` AND** `R < 100 × (10 × Intf + 80)`,  
   - **Walk towards last seen position of target**, then **Exit**.
7. **Otherwise**, **delay action** for `(Rnd[10] + 5) / 20` seconds.

---

### **4. Notes**
- **Due to using `Rnd[10000]`, the random number will not be evenly distributed** *(see chapter 5.5.7).*
- **In the steps where a new `R = Rnd[100]` is calculated, this is NOT a typo but most likely a bug**  
  *(It should have been `R = Rnd[10000]` instead).*

---
---

### **Viper AI**

---

### **1. Winding Walk Mechanic**
Monsters with the **Viper attack type** do not walk straight toward their target like most monsters.  
Instead, they use a **winding movement pattern** that cycles through slight directional shifts.  
This movement follows a **clockwise or counterclockwise drift**, determined by the step in the cycle.

| **Cycle Step** | **Change of Direction** |**N**|**NE**|**E**|**SE**|**S**|**SW**|**W**|**NW**|
|---------------:|------------------------:|:---:|:----:|:---:|:----:|:---:|:----:|:---:|:----:|     
| 1              | Counterclockwise        | NW  | N    | NE  | E    | SE  | S    | SW  | W    |
| 2              | Counterclockwise        | NW  | N    | NE  | E    | SE  | S    | SW  | W    |
| 3              | None                    | N   | NE   | E   | SE   | S   | SW   | W   | NW   |
| 4              | Clockwise               | NE  | E    | SE  | S    | SW  | W    | NW  | N    |
| 5              | Clockwise               | NE  | E    | SE  | S    | SW  | W    | NW  | N    |
| 6              | None                    | N   | NE   | E   | SE   | S   | SW   | W   | NW   |

---

### **2. General Behavior**
1. **If not active** → **Exit**.
2. **Set random value:**  
   - `R = Rnd[100]`

---

### **3. Engagement Logic**
#### **If Target is Adjacent (`Distance = 1`)**
1. **If last action was Delay or Charge**, **perform melee attack**, then **Exit**.
2. **If** `R < Intf + 20`, **perform melee attack**, then **Exit**.
3. **Otherwise**, **delay action** for `(Rnd[10] + 10 - Intf) / 20` seconds.

---

#### **If Target is Nearby (`Distance = 2`)**
1. **If last action was Charge**, **act as Distance > 2 AI**.
2. **If Charge is not possible**, **act as Distance > 2 AI**.
3. **Otherwise**, **perform Charge attack**.

---

#### **If Target is Further Away (`Distance > 2`)**
1. **If last action was Delay**, **walk**, then **Exit**.
2. **If** `R < 2 × Intf + 65`, **walk**, then **Exit**.
3. **Otherwise**, **delay action** for `(Rnd[10] + 15 - Intf) / 20` seconds.

---
---

### **Spit AI**

---

### **1. Circle Walk Mechanic**
Monsters using the **Spit attack type** will continue circling their target until an attack condition is met.  
Once the **circle walk** ends, they will move **toward the last seen position** of their target.

#### **Circle Walk Logic**
1. **If** `R < (100 × (5 × Intf + 5)) / 2`, **perform ranged attack**, then **Exit**.  
   - *(After attacking, the monster will resume circle walk.)*
2. **Otherwise**, **continue circle walking**.

---

### **2. General Behavior**
1. **If not active**, **Exit**.
2. **Set random value:**  
   - `R = Rnd[10000]`

---

### **3. Engagement Logic**
#### **If Target is Adjacent (`Distance = 1`)**
1. **If** `R < (100 × (5 × Intf + 5)) / 2`, **perform ranged attack**, then **Exit**.
2. **If** `R < 100 × (10 × Intf + 60)`, **perform melee attack**, then **Exit**.
3. **Otherwise**, **delay action** for `(Rnd[10] + 5) / 20` seconds.

---

#### **If Target is Further Away & Out of Light (`Distance > 1, Out of Light`)**
1. **Set new random value:**  
   - `R = Rnd[100]`
2. **If** `R < 100 × (10 × Intf + 50)`, **walk towards last seen position of target**, then **Exit**.
3. **If last action was walking and standtime is 0** and  
   `R < 100 × (10 × Intf + 80)`, **walk towards last seen position of target**, then **Exit**.
4. **Otherwise**, **delay action** for `(Rnd[10] + 5) / 20` seconds.

---

#### **If Target is Close (`Distance = 2, In Light`)**
1. **If target is in another area**, **use out of light AI**.
2. **If** `R < (100 × (5 × Intf + 5)) / 2`, **perform ranged attack**, then **Exit**.
3. **Set new random value:**  
   - `R = Rnd[100]`
4. **If** `R < 100 × (10 × Intf + 50)`, **walk towards last seen position of target**, then **Exit**.
5. **If last action was walking and standtime is 0** and  
   `R < 100 × (10 × Intf + 80)`, **walk towards last seen position of target**, then **Exit**.
6. **Otherwise**, **delay action** for `(Rnd[10] + 5) / 20` seconds.

---

#### **If Target is Distant (`Distance > 2, In Light`)**
1. **If target is in another area**, **use out of light AI**.
2. **If** `Rnd[8] = 0`, **start circle walk**, then **Exit**.
3. **If** `R < (100 × (5 × Intf + 10)) / 2`, **perform ranged attack**, then **Exit**.
4. **Set new random value:**  
   - `R = Rnd[100]`
5. **If** `R < 100 × (10 × Intf + 50)`, **walk towards last seen position of target**, then **Exit**.
6. **If last action was walking and standtime is 0** and  
   `R < 100 × (10 × Intf + 80)`, **walk towards last seen position of target**, then **Exit**.
7. **Otherwise**, **delay action** for `(Rnd[10] + 5) / 20` seconds.

---

### **4. Known Bugs & Issues**
- The AI uses `Rnd[10000]`, which does **not** distribute numbers evenly.  
  - *(See Chapter 5.5.7 for more details.)*
- Some steps use `R = Rnd[100]` where it **should likely** be `R = Rnd[10000]`.  
  - *(This is not a typo, but likely an original bug in the AI logic.)*

---
---

### **Butcher AI**

---

#### **General Behavior**
1. If **not active**, **exit**.
2. If `D = 1`, **attack**, then **exit**.
3. Otherwise, **walk towards target**.

---
---

### **Balrog AI**

---

#### **Circle Walk Mechanic**
- When finishing a **circle walk**, a monster using the **Balrog attack type** will start walking towards the **last seen position** of the target.

#### **General Behavior**
1. If **not active**, **exit**.
2. If `D > 4`, **switch to Skeleton AI**, then **exit**.
3. `R = Rnd[10000]` (Set a large random value for probability weighting).

---

#### **Distance = 1 (Adjacent to Target)**
1. If `R < (5 × Intf) + 5`, **do spell attack**, then **exit**.
2. Set a new random value: `R = Rnd[100]`.
3. If `R ≥ (10 × Intf) + 40`, **delay for (Rnd[10] + 5) / 20 seconds**, then **exit**.
4. If `Rnd[2] = 0`, **do spell attack**, then **exit**.
5. Otherwise, **do melee attack**.

---

#### **Distance > 1, Out of Light**
1. If `R < (10 × Intf) + 50`, **walk towards last seen position of target**, then **exit**.
2. If last action was **walk** and `R < (10 × Intf) + 80`, **walk towards last seen position of target**, then **exit**.
3. Otherwise, **delay for (Rnd[10] + 5) / 20 seconds**.

---

#### **Distance = 2, In Light**
1. If last action was **circle walk**, **do spell attack**, then **exit**.
2. If `R < (5 × Intf) + 5`, **do spell attack**, then **exit**.
3. Set a new random value: `R = Rnd[100]`.
4. If `R < (10 × Intf) + 50`, **walk towards last seen position of target**, then **exit**.
5. If last action was **not walk**, **walk towards last seen position of target**, then **exit**.
6. Otherwise, **delay for (Rnd[10] + 5) / 20 seconds**.

---

#### **Distance > 2, In Light**
1. If target is in **same area**, **start circle walk**, then **exit**.
2. If last action was **circle walk**, **do spell attack**, then **exit**.
3. If `R < (5 × Intf) + 10`, **do spell attack**, then **exit**.
4. Set a new random value: `R = Rnd[100]`.
5. If `R < (10 × Intf) + 50`, **walk towards last seen position of target**, then **exit**.
6. If last action was **not walk**, **walk towards last seen position of target**, then **exit**.
7. Otherwise, **delay for (Rnd[10] + 5) / 20 seconds**.

---
---

### **Skeleton King AI**

---

#### **Circle Walk Mechanic**
- When finishing a **circle walk**, a monster using the **Skeleton King attack type** will start walking towards the **last seen position** of the target.

---

#### **General Behavior**
1. If **not active**, **exit**.
2. `R = Rnd[10000]` (Set a large random value for probability weighting).

---

#### **Distance = 1 (Adjacent to Target)**
1. **Single Player Only:** If `R < 5`, **revive skeleton**, then **exit**.
2. If `R < Intf + 20`, **do melee attack**, then **exit**.

---

#### **Distance > 1, Out of Light**
1. If **last action was walking** and `standtime = 0` and `R < Intf + 75`, **walk towards last seen position of target**, then **exit**.
2. If `standtime > 1 second` and `R < Intf + 25`, **walk towards last seen position of target**, then **exit**.
3. Otherwise, **delay for (Rnd[10] + 10) / 20 seconds**.

---

#### **Distance = 2, In Light**
1. **Single Player Only:** If `R < 5`, **revive skeleton**, then **exit**.
2. If **last action was walking** and `standtime = 0` and `R < Intf + 75`, **walk towards last seen position of target**, then **exit**.
3. If `standtime > 1 second` and `R < Intf + 25`, **walk towards last seen position of target**, then **exit**.
4. Otherwise, **delay for (Rnd[10] + 10) / 20 seconds**.

---

#### **Distance > 2, In Light**
1. If **target is in another area**, **use out-of-light AI**.
2. If `Rnd[4] = 0`, **start circle walk**, then **exit**.
3. **Single Player Only:** If `4 × Intf + 35`, **revive skeleton**, then **exit**.
4. If **last action was walking** and `standtime = 0` and `R < Intf + 75`, **walk towards last seen position of target**, then **exit**.
5. If `standtime > 1 second` and `R < Intf + 25`, **walk towards last seen position of target**, then **exit**.
6. Otherwise, **delay for (Rnd[10] + 10) / 20 seconds**.

---
---

### **Horned Demon AI**

---

#### **Circle Walk Mechanic**
- When finishing a **circle walk**, a monster using the **Horned Demon attack type** will start acting **normally** but **will not pick circle walk** as its next action.

---

#### **General Behavior**
1. If **not active**, **exit**.
2. `R = Rnd[10000]` (Set a large random value for probability weighting).

---

#### **Distance = 1 (Adjacent to Target)**
1. If `R < 2 × Intf + 28`, **do melee attack**, then **exit**.

---

#### **Distance = 2 to 4**
1. If **last action was walking** and `standtime = 0` and `R < 2 × Intf + 33`, **walk towards last seen position of target**, then **exit**.
2. If `standtime > 1 second` and `R < 2 × Intf + 83`, **walk towards last seen position of target**.
3. Otherwise, **delay for (Rnd[10] + 10) / 20 seconds**.

---

#### **Distance > 4**
1. If **target is in same area** and `Rnd[4] > 0`, **start circle walk**.
2. If `R < 2 × Intf + 43` and **line of sight is clear**, **do charge attack**, then **exit**.
3. If **last action was walking** and `standtime = 0` and `R < 2 × Intf + 33`, **walk towards last seen position of target**, then **exit**.
4. If `standtime > 1 second` and `R < 2 × Intf + 83`, **walk towards last seen position of target**.
5. Otherwise, **delay for (Rnd[10] + 10) / 20 seconds**.

---
---

### **Mage AI**

---

#### **Phasing Mechanic**
- **Mages can disappear (phase in and phase out)**, similar to *The Hiddens*.
- They **phase out whenever they initiate walking** (including **circle walk**).
- **They phase back in after walking is complete**, even if they remain in the same location.
- **Effect:** Mages are **invisible while walking**.

---

#### **Circle Walk Mechanic**
- When finishing a **circle walk**, a monster using the **Mage attack type** will **start walking towards the last seen position** of the target.

---

### **Retreat Mode**
1. **If `D < 3` (target is close)** → **Walk away from target**.

---

### **General Behavior**
1. If **not active**, **exit**.
2. `R = Rnd[10000]` (Set a large random value for probability weighting).

---

#### **Distance = 1 (Adjacent to Target)**
1. **If `curHP < maxHP / 2`**, enter **retreat mode**.
2. **If last action was a delay**, **do flash attack**, then **exit**.
3. **If `R < 2 × Intf + 20`**, **do flash attack**, then **exit**.
4. Otherwise, **delay for (Rnd[10] + 10 - 2 × Intf) / 20 seconds**.

---

#### **Distance > 1**
1. **If in light** and `R < 5 × Intf + 50` → **Do ranged attack**, then **exit**.
2. **Calculate new R = Rnd[100]**.
3. **If `R < 30`**, enter **circle walk**, then **exit**.
4. Otherwise, **delay for (Rnd[10] + 10 - 2 × Intf) / 20 seconds**.

---

### **Special AI Scripts**

---

#### **Overview**
- Special AI scripts are used for **most quest monsters**.
- For those **not explicitly mentioned**, the **only difference** from the standard AI script of their monster type is **quest-related mechanics** (e.g., talking or scripted events).
- **Combat behavior remains identical** to the normal AI of that monster type.

---

### **Unique Monster AI Table**
| **Unique Monster**          | **AI Script Used** |
|-----------------------------|--------------------|
| Snotspill                   | Fallen One        |
| Gharbad the Weak            | Goat Man         |
| Blackjade                   | Succubi          |
| Red Vex                     | Succubi          |
| Warlord of Blood            | Skeleton         |
| Lachdanan                   | *n/a*            |
| Zhar the Mad                | Mage             |
| Arch-Bishop Lazarus         | Mage             |

